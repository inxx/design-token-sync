name: Create PR for Design Token

on:
  repository_dispatch:
    types: [update-design-tokens]

permissions:
  contents: write
  pull-requests: write

jobs:
  create-pr:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0
        ref: ${{ github.event.client_payload.branch }}

    - name: Set safe.directory
      run: |
        git config --global --add safe.directory /home/runner/work/design-token-sync/design-token-sync

    - name: Configure Git
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"

    - name: Create Pull Request
      id: create_pr
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: 'feat: update design tokens'
        title: 'ğŸ¨ ë””ìì¸ í† í° ìë™ ì—…ë°ì´íŠ¸'
        body: |
          ## ğŸ“‹ ë³€ê²½ì‚¬í•­
          ì—…ë¡œë“œëœ ë””ìì¸ í† í°ìœ¼ë¡œ ìë™ ìƒì„±ëœ PRì…ë‹ˆë‹¤.

          ### ğŸ“Š ìƒì„¸ì •ë³´
          - **íŠ¸ë¦¬ê±° ì‹œê°„**: ${{ github.event.client_payload.timestamp }}
          - **ë¸Œëœì¹˜**: ${{ github.event.client_payload.branch }}
          - **ë©”ì‹œì§€**: ${{ github.event.client_payload.message }}

          ### ğŸ”§ ë³€ê²½ëœ íŒŒì¼
          - `style-dictionary/tokens.json`: ìƒˆë¡œìš´ ë””ìì¸ í† í°
          - `styles/variables.css`: ìë™ ìƒì„±ëœ CSS ë³€ìˆ˜

          ### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
          - [x] ë””ìì¸ í† í° JSON íŒŒì¼ ì—…ë°ì´íŠ¸
          - [x] CSS ë³€ìˆ˜ ìë™ ìƒì„± ì™„ë£Œ
          - [x] ë¹Œë“œ ê²€ì¦ ì™„ë£Œ

          ---
          ğŸ¤– ì´ PRì€ ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
        branch: ${{ github.event.client_payload.branch }}
        base: main
        delete-branch: true
        labels: |
          design-tokens
          auto-generated

    - name: Check PR creation result
      run: |
        if [ "${{ steps.create_pr.outputs.pull-request-number }}" != "" ]; then
          echo "âœ… PR #${{ steps.create_pr.outputs.pull-request-number }} ìƒì„± ì™„ë£Œ"
          echo "ğŸ”— PR URL: ${{ steps.create_pr.outputs.pull-request-url }}"
        else
          echo "â„¹ï¸ ë³€ê²½ì‚¬í•­ì´ ì—†ì–´ PRì„ ìƒì„±í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
        fi 